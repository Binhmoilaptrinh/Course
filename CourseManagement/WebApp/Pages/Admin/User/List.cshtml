@page
@model WebApp.Pages.Admin.User.ListModel
@{
    Layout = "_ManagementLayout";
}

<div class="popular-courses">
    <h2 class="courses-title mt-5 px-5">Quản lý người dùng</h2>
    <div class="popular-header px-5">
        <p class="popular-des">Danh sách người dùng</p>
        <a href="./Create"><button class="popular-button">Thêm người dùng</button></a>
    </div>
    <div class="row mt-4 px-5">
        <div class="col-6 d-flex align-items-center">
            <span class="fs-3 me-3">Hiển thị</span>
            <select id="pageSize" class="drop-show_number">
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="15">15</option>
            </select>
            <span class="fs-3 ms-3">người</span>
            <select id="roleUser" class="drop-show_number">
                <option value="">Tất cả vai trò</option>
            </select>
        </div>
        <div class="col-6 d-flex justify-content-end">
            <button id="refreshButton" class="btn btn-primary">Làm mới</button>
        </div>
    </div>
    <div class="container mt-5">
        <div id="userList" class="courses-container">
            <!-- Danh sách người dùng sẽ được cập nhật ở đây -->
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const userList = document.getElementById("userList");

        async function fetchUsers() {
            try {
                const response = await fetch("https://api.2handshop.id.vn/api/User/all");
                if (!response.ok) throw new Error("Lỗi HTTP: " + response.status);
                const users = await response.json();
                renderUsers(users);
            } catch (error) {
                console.error("Lỗi tải danh sách người dùng:", error);
                userList.innerHTML = '<p class="text-danger">Không thể tải danh sách người dùng.</p>';
            }
        }

        function renderUsers(users) {
            userList.innerHTML = '';
            if (!users || users.length === 0) {
                userList.innerHTML = '<p class="text-warning">Không có người dùng nào.</p>';
                return;
            }
            users.forEach(user => {
                userList.innerHTML += `
                    <div class="courses-item">
                        <img src="${user.avatar || 'default-avatar.png'}" class="user-avatar" alt="Avatar" />
                        <h3>${user.userName}</h3>
                        <p>Vai trò: ${user.role || 'Không xác định'}</p>
                        <a href="./Update/${user.userId}" class="btn btn-warning">Sửa</a>
                        <a href="./Delete?id=${user.userId}" class="btn btn-danger">Xóa</a>
                    </div>`;
            });
        }

        document.getElementById('refreshButton').addEventListener('click', fetchUsers);
        fetchUsers();
    });
</script>


